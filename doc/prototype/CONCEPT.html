
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML> 
<HEAD>
<TITLE> 
    SMOKE Concept
</TITLE>
</HEAD>
   
<BODY>
<H1>
    SMOKE Concept
</H1>

<VAR>!! under construction !!</VAR>

<UL>
    <LI>  <A HREF = "#intro">     Introduction </A>
    <LI>  <A HREF = "#form">      Formulation </A>
    <LI>  <A HREF = "#equations"> Data Stores, Variables, and Equations </A>
    <LI>  <A HREF = "#interface"> User Interfaces </A>
</UL>
<HR>
    
<H2> <A NAME = "intro"> Introduction </A> </H2>

    The existing paradigm for atmospheric emissions models is a 
    network-of-pipes-and-filters paradigm.  
    This paradigm is used by ROM and RADM's FREDS, by UAM's EPS 
    and by GEMAP (reaching its fullest flower perhaps in the last
    two).  At any given stage in the processing, each source is
    treated as being a self-contained record describing that source
    (and, especially in the case of GEMAP) the attributes leading
    up to it.  Each processing stage is regarded as a filter which
    takes a stream of such self-contained records, together with 
    data from one or more auxilliary files, and produces a new
    stream of these records, passing much redundant data down the 
    pipe, at the cost of considerable extra I/O and program complexity.   
    All of the processing is performed one record at a time, with no 
    exposed parallelism, and no implied structure as to the order of 
    their records (and in the case of EPS, very few assumptions even 
    as to their contents).  This paradigm is admirably suited to 
    1970's-vintage machines with miniscule available memories and 
    tape-only storage, but is not well adapted to current desktop 
    machines, much less high performance supercomputers.  It is 
    interesting to note that the lack of expressed parallelism 
    causes EPS to run four times slower on a Cray Y-MP than on a 
    desktop 150MHZ DEC Alphastation 3000/300 (where all the data 
    structures are at least cache-resident), indicating the 
    almost-total absence of usable parallelism in the implementation.
    <P> 
    
    A little analysis shows that the computations being performed
    should be admirably adaptable to HPCC, if only the paradigm is
    changed appropriately.  For each category of emissions (point
    source, area source, mobile source, or biogenic source), the 
    following tasks need to be performed by an emissions model:
    <UL>
        <LI>  to read an emissions inventory; 
        <LI>  to QA it; 
        <LI>  to transform inventory species into model species; 
        <LI>  to project from the inventory year to the (future or past)
              modeled year; 
        <LI>  to apply controls (except to biogenics); 
        <LI>  to model the temporal distribution of the emissions;
        <LI>  to model the spatial distribution of the emissions; and
        <LI>  to merge the various classes of emissions together to
              form model input.
    </UL>    
    
    There are particular complexities dealing with each of the specific 
    types of emissions.  For all of these types, however, most of the 
    tasks are <EM>factor-based</EM> -- that is, they are linear 
    operations which can be represented as multiplications
    by matrices.  A little further examination shows that the 
    matrices which arise are <STRONG>sparse</STRONG> matrices (i.e., 
    most of their entries are zeros).  We propose to take advantage 
    of these facts in order to formulate emissions modeling in terms 
    of sparse matrix operations which can then be performed by HPCC-adapted
    vendor optimized sparse matrix libraries.  Because matrix multiplication 
    is associative (can be regrouped), we will further re-arrange the 
    order of multiplications to avoid redundant computations.  
    The fact that for each inventory, temporal modeling is done 
    only once per episode, that gridding matrices are calculated 
    only once per grid, and speciation matrices are calculated only
    once per chemical mechanism contributes not only to computational
    efficiency but also to the integrity and consistency of the model
    inputs generated by the system
    <P> 
    


<H2> <A Name = "form"> 
    A Sparse Matrix Formulation Of Emissions Modeling </A> </H2>

    In order to implement a sparse matrix formulation of emissions
    modeling, we have to analyze the content of emissions modeling to
    find which conceptual operations in emissions modeling are factor-based.  
    Such analysis finds that <EM>most</EM> of the modeling of anthropogenic
    sources--the modeling of:
    <UL>
        <LI>  control and (future/past year) projection,
        <LI>  speciation,
        <LI>  spatial allocation (gridding), and
        <LI>  much of temporal allocation
    </UL>
    is factor based, with factor-based and substitution-based operations 
    occurring side by side in temporal modeling and control application.
    This suggests a reorganization of emissions modeling into four
    phases:
    <UL>
        <LI>  ordering of the data into vectors, so that matrix
              operations are appropriate; 
        <LI>  calculation of independent matrices for each of the
              conceptual operations; 
        <LI>  forming the product of these matrices; and 
        <LI>  applying the product matrix to the emissions inventory
              vector.
    </UL>
    <P> 
    
    In practice, the anthropogenic portion of emissions modeling really 
    splits into three separate sub-models:  one each for 
    <A HREF = "AREA.html"> <STRONG>area</STRONG></A>, 
    <A HREF = "POINT.html"> <STRONG>point</STRONG></A>, 
    and <A HREF = "MOBILE.html"> <STRONG>mobile</STRONG> </A> sources.  
    Additionally, emissions modeling requires the treatment of 
    <A HREF = "BIOGENIC.html"> <STRONG>biogenic</STRONG> </A> and
    other naturally-occurring sources, and provisions for
    <A HREF = "MERGE.html"><STRONG>merging</STRONG></A> the four 
    classes of emissions into model ready emissions.  We anticipate that 
    each sub-model should split into components roughly as described 
    below (with quite possibly, although not necessarily) some 
    sharing of components between the sub-models.  Since these 
    components would behave similarly for all three sub-models, 
    we will describe them in general below, with specific exceptions 
    and considerations to be discussed later.  Each submodel of a 
    sparse-matrix based emissions model behave as indicated in the
    <STRONG>accompanying diagram,</STRONG> as
    <A HREF = "emissions.ps"><STRONG> Postscript</STRONG></A>, as
    <A HREF = "figs/emissions.jpg"><STRONG> JPEG</STRONG></A>, as
    <A HREF = "figs/emissions.xbm"><STRONG> X11 bitmap</STRONG></A>, or as 
    <A HREF = "figs/emissions.gif"><STRONG> GIF</STRONG></A>.
    <P> 
    
    The components are as follows:
    <P>     
    
    The <STRONG>Data Structuring</STRONG> model reads an inventory 
    and puts its sources into &quot;canonical&quot; order.  It produces
    two data sets:  annual source-level total emissions values in 
    canonical order, which we will want to think of as a column vector, 
    and an emissions database/index/attributes table (&quot;the 
    <STRONG>DB</STRONG>&quot;) with the same ordering as the emissions 
    value vector.  The DB has further structure (giving source locations, 
    stack parameters (if appropriate), temporal and speciation profiles, 
    etc.) used by the other submodels that is beyond the scope of this 
    section and instead detailed elsewhere in the sections on  
    <A HREF = "#equations">data stores, variables, and equations</A> and 
    the section on <A HREF = "RAWDATA.html">raw data import processing</A>. 
    What is important for representing  other processes by matrix 
    operations is that there be <EM>some</EM> order (in which lookups 
    take place by subscripting rather than by searches), not what the 
    particular order is--the attribute used for sorting could well be 
    chosen to optimize some other emissions-related task.  Note that 
    Data Structuring is independent of AQM and control strategy; 
    frequently it is also independent of time period chosen as well.
    Data structuring maps into SMOKE programs 
    <A HREF = "AREA.html#RAWAREA">RAWAREA</A> for area sources,
    <A HREF = "MOBILE.html#RAWMOBIL">RAWMOBIL</A> for mobile sources, and
    <A HREF = "POINT.html#RAWPOINT">RAWPOINT</A> for point sources.
    <P> 
    
    The <STRONG>Future-Past Projection</STRONG> model deals with the 
    construction of emissions data sets for years other than inventory 
    years. If no new sources are involved, this could be performed 
    merely by multiplying the emissions values by the diagonal  
    (hence sparse) matrix of the growth factors.  In the presence 
    of new sources, or if it is desirable to completely remove large
    numbers of no-longer-active sources, then Future-Past Projection 
    interacts with Data Structuring to produce a new ordering of sources, 
    and correspondingly a new emissions values vector and a new DB.  
    (In the absence of new sources, the  functions of the Future-Past 
    Projection model may be  performed by the Control Model 
    (described below), instead).  In the current edition of SMOKE, this
    latter sort of projection maps into SMOKE programs
    <A HREF = "AREA.html#CTLAMAT">CTLAMAT</A> for area sources,
    <A HREF = "MOBILE.html#CTLMMAT">CTLMMAT</A> for mobile sources, and
    <A HREF = "POINT.html#CTLPMAT">CTLPMAT</A> for point sources.
    <P> 
    
    The <STRONG>Temporal Model</STRONG> takes the vector of emissions 
    totals and information from the emissions DB, and 
    constructs a sequence of source level time stepped (probably hourly, 
    inventory species) emissions vectors.  For the existing prototype, 
    most of the calculations involved are implemented internally as 
    sparse matrix algebra based upon temporal profiles from the DB, 
    augmented by the substitution of values from period specific 
    observational data from the DB and by modifications due to the 
    meteorology (e.g., to allow for the temperature dependence of 
    evaporation rates, etc.).  For more advanced emissions modeling and
    particularly for biogenics emissions, the temporal model may be a
    true simulation model driven by ambient meteorology and other
    data.  Note that the time stepped emissions value vectors are 
    independent of choice of AQM, depending only upon the time period 
    chosen and the source characteristics in the emissions DB.
    Temporal modeling maps into SMOKE programs 
    <A HREF = "AREA.html#TMPAREA">TMPAREA</A> for area sources,
    <A HREF = "BIOGENICS.html#TMPBIO">TMPBIO</A> for biogenic sources,
    <A HREF = "MOBILE.html#TMPMOBIL">TMPMOBIL</A> for mobile sources, and
    <A HREF = "POINT.html#TMPPOINT">TMPPOINT</A> for point sources.
    <P> 
    
    The <STRONG>Speciation Model</STRONG> takes a choice of chemical 
    mechanism from the AQM definition and speciation profiles from 
    the emissions DB, and constructs a sparse matrix (the
    speciation matrix) which transforms column vectors of 
    inventory-species emissions into column vectors of 
    model-species emissions.  Note that the speciation matrix
    depends only upon the AQM's chemical mechanism and the DB.
    Speciation modeling maps into SMOKE programs 
    <A HREF = "AREA.html#SPCAMAT">SPCAMAT</A> for area sources,
    <A HREF = "MOBILE.html#SPCMMAT">SPCMMAT</A> for mobile sources, and
    <A HREF = "POINT.html#SPCPMAT">SPCPMAT</A> for point sources.
    <P> 
    
    The <STRONG>Gridding Model</STRONG> takes a grid specification from 
    the AQM definition and source locations from the emissions DB, and 
    constructs a sparse matrix (the gridding matrix) which transforms 
    source-level column vectors into grid-cell-level column vectors 
    (where the storage order for the grid is thought of as defining 
    an ordering which specifies the structure as a column vector).  
    Note that the gridding matrix depends only upon the source locations 
    and the choice of grid for the AQM.
    Grid modeling maps into SMOKE programs 
    <A HREF = "AREA.html#GRDAMAT">GRDAMAT</A> for area sources,
    <A HREF = "MOBILE.html#GRDMMAT">GRDMMAT</A> for mobile sources, and
    <A HREF = "POINT.html#GRDPMAT">GRDPMAT</A> for point sources.
    <P> 
    
    The <STRONG>Control Model</STRONG> takes controls specified by the
    decision maker and information from the emissions DB 
    and produces a diagonal (and therefore sparse) matrix 
    of source level control factors (the control matrix).
    The control model should probably interact with a
    socioeconomic model so that it can provide cost data and
    other feedback about the controls chosen to the decision 
    maker.  Note that the control matrix depends only upon 
    the emissions DB and the set of controls chosen.  In simple cases
    (where no new sources are introduced), it may be advantageous to 
    treat future/past-year projection as a special case of controls.
    When this is done, the control matrix depends upon the future/past
    year chosen.
    Control modeling maps into SMOKE programs 
    <A HREF = "AREA.html#CTLAMAT">CTLAMAT</A> for area sources, to some
    extent into  <A HREF = "MOBILE.html#CTLMMAT">CTLMMAT</A> for mobile
    sources (although most control programs require re-running the
    entirety of mobile processing, starting at MOBILE-5), and
    <A HREF = "POINT.html#CTLPMAT">CTLPMAT</A> for point sources.
    <P> 
    
    <STRONG>AQM Setup</STRONG> multiplies the control matrix, the 
    gridding matrix, and the speciation matrix to produce a composite
    transform matrix for input to the Emissions Transform Module (below).
    Note that AQM setup depends upon choice of control strategy
    (possibly including projection factors if future/past-year
    projection is treated within the control model), grid specification, 
    and chemical mechanism only.
    <P> 
    
    The <STRONG>Emissions Transform Module</STRONG> behaves as 
    follows:  On startup, it reads the transform matrix.  Then at every
    emissions time step (typically, at every hour), it reads that time step's 
    emissions vector and multiplies it by the transform matrix to obtain 
    model-speciated gridded controlled emissions.  Pragmatically, the 
    AQM Setup Module may well be combined with the Emissions Transform 
    Module; it may either be a standalone preprocessor to the AQM or 
    be a module (subroutine) within it.
    In the current implementation of SMOKE, Setup and Emissions Transform 
    Modeling are combined into SMOKE programs 
    <A HREF = "MERGE.html#CSGLMERGE">CSGLMERGE</A> for EDSS-style
    (high-vertical-resolution) modeling and into the combination of
    <A HREF = "MERGE.html#CSGMERGE">CSGMERGE</A> for lower-level sources, and
    <A HREF = "MERGE.html#CSELEV">CSELEV</A> for elevated-plume sources.
    <P> 
    
    This organization has a number of advantages.  First of all,
    the processes are made much more independent and modular.  
    This promotes better integrity:  the very same time stepped 
    source level emissions file is used for the base case and
    for control strategies, for each grid in a nest of grids, for
    example.  It also avoids many expensive recalculations.  The
    implementation of a new control strategy, for example, will
    typically require only the construction of a new control
    matrix, a new transform matrix using it, and the running the
    emissions transform moduel and the AQM.  The time between completing 
    a new control strategy definition and being ready to run the AQM 
    can be reduced to minutes or seconds, as compared with the
    current practice with perhaps a one-week turnaround time 
    for re-running the entire emissions model (since the 
    control model frequently has to be at the head of the network 
    of filters).  The modeling emphasis is much more on getting a 
    correct setup for the emissions scenario in terms of the emissions 
    inventory and the AQM definition, and then being able to achieve 
    rapid turnaround for control strategy development and assessment; 
    however even the setup should be more efficient computationally 
    than that of older-style models which make repeated (redundant)
    use of inefficient linear-search algorithms for lookups.
    It is interesting to compare the processing for the base case with
    the processing for a new control strategy to see how much redundant
    calculation is avoided by the new paradigm.  Diagrams describing
    <STRONG>base case</STRONG> processing for UAM air quality 
    modeling in
    <A HREF = "figs/BASE.UAM.ps">Postscript</A>, in
    <A HREF = "figs/BASE.UAM.gif">GIF</A>, in
    <A HREF = "figs/BASE.UAM.xbm">X bitmap</A>, and in
    <A HREF = "figs/BASE.UAM.jpg">JPEG</A>; 
    and also for EDSS air quality modeling in
    <A HREF = "figs/BASE.EDSS.ps">Postscript</A>, in
    <A HREF = "figs/BASE.EDSS.gif">GIF</A>, in
    <A HREF = "figs/BASE.EDSS.xbm">X bitmap</A>, and in
    <A HREF = "figs/BASE.EDSS.jpg">JPEG</A>; likewise, diagrams describing
    <STRONG>new control strategy</STRONG> processing for UAM air quality 
    modeling are available in
    <A HREF = "figs/STRATEGY.UAM.ps">Postscript</A>, in
    <A HREF = "figs/STRATEGY.UAM.gif">GIF</A>, in
    <A HREF = "figs/STRATEGY.UAM.xbm">X bitmap</A>, and in
    <A HREF = "figs/STRATEGY.UAM.jpg">JPEG</A>; 
    and also for EDSS air quality modeling in
    <A HREF = "figs/STRATEGY.EDSS.ps">Postscript</A>, in
    <A HREF = "figs/STRATEGY.EDSS.gif">GIF</A>, in
    <A HREF = "figs/STRATEGY.EDSS.xbm">X bitmap</A>, and in
    <A HREF = "figs/STRATEGY.EDSS.jpg">JPEG</A>.  This should be contrasted
    with the situation for UAM EPS emissions modeling, for which it is
    every bit as complex to prepare a new control strategy as it is to
    prepare the original base case.  Likewise, in preparing multiple
    air quality episodes for the same region, notice that only the
    merge program needs to be run for every combination of control
    strategy and episode:  the speciation and gridding matrices need 
    be computed only once; the control matrices once per control strategy, 
    and the time-stepped emissions once per episode.
    <P> 
    
    The computational performance of the emissions model should be even 
    greater with this organization on modern--especially 
    HPCC--architectures, since the parallelism in the vector-matrix 
    operations is explicitly available and since this organization can 
    potentially take advantage of vendor-optimized libraries.  The use 
    of a canonical source ordering eliminates the searches (frequently 
    linear(!)) searches, as in UAM/EPS) that degrade conventional emissions 
    model performance.  Enormous amounts of redundancy found in the
    emissions records are eliminated, having both the effect of
    greatly reducing storage requirements and of improving data
    integrity.  For urban-resolution modeling, the data volume for 
    source level emissions is much smaller than that for gridded 
    emissions; quite possibly the I/O time for an emissions transform
    module within the AQM is sufficiently reduced to more than cover 
    the cost of the extra matrix multiplications.  For regional
    modeling, however, the I/O tradeoff tends to go in the opposite
    direction, to favor a standalone Emissions Transform preprocessor.
    <P> 
    
    For the most part, new control strategies do not require
    rerunning any of the other components of the emissions model.
    There are a couple of special cases which do require rerunning
    other components, however.  One of these is the application of process
    changes for a source category which require re-running the 
    speciation model--a change which replaces organic solvents 
    by aqueous solvents, for example.  Another is a change in 
    operating schedule for a particular source category, which
    would require re-running of the temporal model.  (Both of these are
    characteristic of Mobile-5 based mobile source emissions modeling,
    in which conventionally the entire control program is fed into the
    program which computes the emissions factors.)  Although either of 
    these types of controls requires much more recomputation than simpler
    control strategies do, they are still much cheaper than the 
    corresponding strategy is with an older model (particularly 
    since for the older models, the most expensive part of the 
    model is the gridding, which the new model would not need to 
    recalculate).
    <P> 
    
    The sparse-matrix emissions model implementation is perhaps the
    simplest (and possibly most efficient) for area sources (which, 
    it should be noted, are the most expensive component computationally 
    for &quot;conventional&quot; emissions models).  With point sources, 
    one needs to split out major point sources for special treatment 
    (possibly by plume-in-grid modeling), and also to worry about 
    plume rise considerations.  The precise formulation of what one 
    means by &quot;source level emissions&quot; for mobile sources
    needs careful treatment, as do the necessity for performing
    traffic modeling, and the nonlinearities in the emissions due 
    to controls on traffic volume which lead to changes in vehicular 
    speed profiles, etc.  
    <P> 
    
    It may be possible to bring some aspects of biogenic emissions
    modeling into this paradigm.  Because of the feedback between
    biogenic emissions and environment quality--both ambient ozone 
    and recent acid deposition--it may be best to move the biogenic 
    emissions model into the AQM.  However, it might be
    advantageous for the biogenic emissions model to work in terms
    of (homogeneous) land-use tracts, and then to apply a composite
    speciation-gridding matrix to transform the resulting emissions
    into a form usable by the rest of the AQM.  In that case,
    sparse matrices for &quot;ungridding&quot; will also be needed to
    transform both meteorology and ambient air quality data from 
    the AQM grid to the land-use tracts.  (Ungridding matrices are also
    needed to construct source level temperature fields for mobile
    source processing; such matrices can efficiently be constructed at
    the same time, and using the same input data as, the gridding
    matrices).
    <P> 
    
    
<H2> <A NAME = "equations"> 
    Data Stores, Variables, and Equations </A> </H2>
    
    The <STRONG>Emissions Source Database</STRONG> is the primary 
    repository for emissions source attributes and related data.  
    It is here that we may deal with sources as independent 
    (fine-grained) objects (as opposed with dealing with them 
    as components of large-scale vector (or &quot;field&quot;) objects, 
    whether source level or grid level), as we do throughout the 
    rest of the emissions modeling system.  I assume that these 
    tables should be at least as rich as the &quot;raw data&quot; 
    files for UAM EPS.   Important tables in the Emissions Source 
    Database include the following:
    <UL>
        <LI>  source attributes
        <LI>  temporal activity profiles
        <LI>  speciation profiles
        <LI>  spatial surrogate data
        <LI>  location data
        <LI>  FIPS index table
        <LI>  source category (ASC/SCC/SIC) tables
        <LI>  activity-related data
        <LI>  episode-specific data
    </UL><P> 

    In the following, we will use the <EM>HTML-3 MATH</EM>
    conventions for setting up equations for web consumption.  If 
    they don't show up correctly, (a) Use "view source" to see the
    original HTML -- it should not be hard to decipher; and (b) go
    yell at Netscape (or whoever) for not following standards.<P> 
    
    We will use the following <STRONG>names for variables</STRONG>
    used in the equations:
    <UL>
        <LI>  <STRONG>NI</STRONG> is the number of inventory species
        
        <LI>  <STRONG>NM</STRONG> is the number of model emissions species
        
        <LI>  <STRONG>NS</STRONG> is the number of sources
        
        <LI>  <STRONG>NG</STRONG> is the number of horizontal-grid cells 
              (<MATH>= ncols&nbsp;&#183;&nbsp;nrows</MATH>)
        
        <LI>  <STRONG>NX</STRONG> is the maximum number of sources 
              intersecting a single grid cell
        
        <LI>  <STRONG>s</STRONG> is source subscript
        
        <LI>  <STRONG>u</STRONG> is emissions inventory species subscript
        
        <LI>  <MATH><STRONG>t</STRONG> = u + ( s - 1 ) </MATH>
              (number of inventory species) is the subscript for 
              singly-indexed source level species.
        
        <LI>  <MATH><STRONG>c</STRONG>  = row + col&nbsp;&#183;&nbsp;( nrows - 1 )</MATH>
              is a grid-cell subscript, singly indexed 

        <LI>  <STRONG>v</STRONG> is model species subscript
    
        <LI>  <STRONG>R<SUB>NG</SUB></STRONG> is a dummy source variable 
              subscripted by source number
    
        <LI>  <STRONG>G<SUB>NG</SUB></STRONG> is a dummy gridded variable 
              subscripted by (singly-indexed) cell number
    
        <LI>  <STRONG>E<SUB>NG,NM</SUB></STRONG> is the output gridded emissions 
              field subscripted by (singly-indexed) cell number and by 
              model species.
        
        <LI>  <STRONG>S<SUB>NS,NI</SUB></STRONG> and 
              <STRONG>T<SUB>NS&#183;NI</SUB></STRONG> 
              are the vectors storing the input inventory speciated 
              source level emissions field, either doubly-indexed by 
              source and species or singly indexed by composite of 
              source and species (i.e., it is the entirety of a time 
              step of emissions, thought of as a single object).
        
        <LI>  <STRONG>U<SUB>NS,NM</SUB></STRONG> and 
              <STRONG>VT<SUB>NS&#183;NM</SUB></STRONG> 
              are the vector storing the model speciated input source 
              level emissions field, either doubly-indexed by source and 
              species or singly indexed by composite of source and species.
        
        <LI>  <STRONG>CC<SUB>NS</SUB></STRONG> is the 
              <STRONG>control matrix</STRONG>, 
              according to the following equation (where Q and R are input 
              and output dummy source variables, respectively):
              <BR> 
              
              <MATH>
              <BLOCKQUOTE>
                  R<SUB>s</SUB> = CC<SUB>s</SUB>&nbsp;&#183;&nbsp;Q<SUB>s</SUB>
              </BLOCKQUOTE>
              </MATH>
            
        
        <LI>  <STRONG>&lt;MG<SUB>NG</SUB>,
                          CG<SUB>NG,NX</SUB>,
                          IG<SUB>NG,NX</SUB>&gt;</STRONG>
              represent the <STRONG>gridding matrix</STRONG>, according to 
              the following equation (where G is a dummy gridded variable, 
              and R is a dummy source variable):
              <BR> 
            
              <MATH>
              <BLOCKQUOTE>
          G<SUB>c</SUB> = &sum;<SUB>s=1</SUB><SUP>MG<SUB>c</SUB></SUP> 
          CG<SUB>c,s</SUB>&nbsp;&#183;&nbsp;R<SUB>IG<SUB>c,s</SUB></SUB>
              </BLOCKQUOTE>
              </MATH>
                             
    
        <LI>  <STRONG>&lt;MS<SUB>NS</SUB>,
                          CS<SUB>NS,NM,NI</SUB>,
                          IS<SUB>NS,NM,NI</SUB>&gt;</STRONG> 
              represent the most general sort of 
              <STRONG>speciation matrix</STRONG> according to the 
              following equation:
              <BR> 
            
              <MATH>
              <BLOCKQUOTE>
          U<SUB>s,v</SUB> 
          = &sum;<SUB>u=1</SUB><SUP>MS<SUB>s</SUB></SUP>  
          CS<SUB>s,v,u</SUB>&nbsp;&#183;&nbsp;S<SUB>s,IS<SUB>s,v,u</SUB></SUB>
              </BLOCKQUOTE>
              </MATH>
              
              <STRONG>Note</STRONG> that because of the implicit EPS 
              assumption that each emitted model species has exactly 
              one inventory species giving rise to it (in fact, 
              NOX&nbsp;~~&gt;&nbsp;{NO,NO<SUB>2</SUB>}, CO&nbsp;~~&gt;&nbsp;CO, 
              and VOC&nbsp;~~&gt;&nbsp;&lt;everything else&gt;), this 
              coefficient matrix may be replaced by a set of diagonal 
              matrices, one for each emitted model species:
              <BR>
              
              <MATH>
              <BLOCKQUOTE>
          U<SUB>s,v</SUB> =
          CCS<SUB>s,v</SUB>&nbsp;&#183;&nbsp;S<SUB>s,ISS<SUB>v</SUB></SUB>
              </BLOCKQUOTE>
              </MATH>
              <BR>
              where CCS<SUB>s,v</SUB> is the diagonal coefficient matrix 
              for speciation from inventory pollutant ISS<SUB>v</SUB> to 
              model species <VAR>v</VAR>.
            
        <LI>  <STRONG>&lt;MG<SUB>NG</SUB>,
                          T<SUB>NG,NM,NX&#183;NI</SUB>,
                          IT<SUB>NG,NM,NX&#183;NI</SUB>&gt;</STRONG> 
              represent the composite control-gridding-speciation 
              <STRONG>transform matrix</STRONG>, which is the product 
              of the speciation matrix with the NI'th tensor product 
              representation (this is mathematics jargon for saying that 
              gridding and control depend only on source number and ignore 
              the species) of the product of the control matrix and the 
              gridding matrix, according to the following pair of equations 
              (of which the first gives the final formula; the second 
              serves to give the formula for computing this product):
              <BR> 
              <MATH>
              <BLOCKQUOTE>
          E<SUB>c,v</SUB> = &sum;<SUB>t=1</SUB><SUP>MG<SUB>c</SUB></SUP>  
          CT<SUB>c,v,t</SUB>&nbsp;&#183;&nbsp;T<SUB>IT<SUB>c,v,t</SUB></SUB>
              <BR> 
              
              = &sum;<SUB>s=1</SUB><SUP>MG<SUB>c</SUB></SUP>
                    &sum;<SUB>u=1</SUB><SUP>NI</SUP>
CC<SUB>IG<SUB>c,s</SUB></SUB>&nbsp;&#183;&nbsp;CG<SUB>c,s</SUB>&nbsp;&#183;&nbsp;CS<SUB>IG<SUB>c,s</SUB>,v,u</SUB>&nbsp;&#183;&nbsp;S<SUB>IG<SUB>c,s</SUB>,IS<SUB>IG<SUB>c,s</SUB>,v,u</SUB></SUB>
              </BLOCKQUOTE>
              </MATH>
        </UL>
            
<H2> <A NAME = "interface"> 
     User Interfaces </A> </H2>
    
    Context diagrams indicating how an emissions modeling system 
    <EM>should</EM> fit into the entirety of a decision support system 
    are available in <A HREF = "figs/CONTEXT.ps">Postscript</A>, in
    <A HREF = "figs/CONTEXT.gif">GIF</A>, in
    <A HREF = "figs/CONTEXT.xbm">X bitmap</A>, and in
    <A HREF = "figs/CONTEXT.jpg">JPEG</A>.  (In this diagram, interactions
    appearing during the scenario selection process are suppressed in
    the interest of avoiding a real tangle of extra dataflows; in
    actuality, the user would also interact with the AQM definition,
    with the emissions inventory, and with the meteorology model (often
    through the mediation of the analysis and visualization subsystem) 
    during scenario selection.)   Notice that in such an idealized
    system, most of the interactions between the user and the rest of
    the system rely upon the analysis and visualization subsystem to
    present results to the user and interpret them for him, and upon a
    socioeconomic model to evaluate costs and project growths and
    secondary effects for control scenarios.

    <H3> Data Structuring / Emissions Source Database </H3>
        
        This is one of the messy ones... In it, individual sources are
        regarded as being objects; the user may wish to view or to edit
        the attributes of these sources on a source-by-source basis.
        As such, the user continually interfaces with it during
        emissions control strategy development.  Quite possibly,
        however, it is hidden as part of the control model interface
        (below).
    
    <H3> Future/Past Projection Model -- Socioeconomic Model </H3>
        
        The user interfaces with the projection model once per future
        or past year treated (probably no more than six or eight times,
        during setup).  The user needs to be able to examine
        predictions coming from socionomic projection models and
        reformulate them in terms of growth factors for the various
        source classifications, to be able to delete sources as they go
        off-line, and to be able to add new sources which will go
        on-line for the predicted period.
    
    <H3> Temporal Model </H3>
        
        For point and area sources, the user interfaces with the 
        temporal model once per episode -- probably no more than a 
        dozen or so times, during the construction of the base case for
        that episode.  For mobile sources, more complex interaction 
        (perhaps managed by the interface to the Control Model) may 
        well be necessary, since varying the traffic patterns for a
        control strategy necessitates rerunning the mobile-sorurce
        temporal model for the period in question.
        
    <H3> Model Definition:  Speciation Model </H3>
        
        The user interfaces with the speciation model once per chemical
        mechanism and inventory (probably once and for all during
        region set-up).
        
        The &quot;minimal version&quot; of speciation model requires 
        something like the category based and source specific speciation 
        profiles used by the UAM EPS as starting data.  Cary Jang tells
        me that these profiles are the responsibility of the chemical
        mechanism developer.
        
        The &quot;full version&quot; of speciation model can help the user
        develop these profiles, as well as supporting source-by-source
        changes to them corresponding to process changes for the source
        category (transitioning from organic to water based solvents
        for a particular industry in a particular county, for example),
        although in practice it may well be to present this functionality 
        from the interface to the Control Model.
    
    <H3> Model Definition:  Gridding Model </H3>
        
        The user interfaces with the gridding model once per grid and
        inventory (probably once and for all during region set-up).
        <P> 
        
        The &quot;minimal version&quot; of gridding model requires something 
        like the surrogate cross references and gridded surrogate fractions 
        used by UAM EPS as starting data, together with the FIPS and 
        SCC tables.  This kind of model requires that calculation of
        surrogate fractions be performed &quot;by magic&quot; off-line, quite
        possibly by a GIS system, and probably for some master grid.
        Only grids which are obtained from the master grid by
        aggregation and/or windowing (i.e., only grids for which 
        each cell is a union of cells in the master grid) can be 
        handled by the minimal version.
        <P> 
        
        The &quot;full version&quot; of gridding model requires raw surrogate
        data (e.g., surrogate values by census tract, or other high
        resolution GIS object), together with basic knowledge of map
        projections and grid definition conventions.  It takes the
        user's input grid specification, computes gridded surrogate
        fractions (which are <EM>input</EM> to the minimal version), and can
        then display them against a map.  
        <P> 
        
        A potentially &quot;optimizing version&quot; allows the user to specify
        the cellsize and the minimum acceptable geographic coverage, 
        and then computes the optimum grid for those constraints, in
        the sense of the grid which best resolves the sources present.  
        This may be thought of as a variational problem, maximizing 
        the functional below (which happens if the cells &quot;resolve&quot;
        features, rather than dividing them up):
        <BR>     
        <MATH>
	<BOX>
            ( &sum;<SUB><TEXT> cells </TEXT></SUB> 
                  &sum;<SUB><TEXT> surrogate categories </TEXT></SUB>  
                     { <TEXT>(cell-fraction)</TEXT><SUP> 2 </SUP> ) 
                       <over> 
                       <TEXT>domain area</TEXT> }
        </BOX>
	</MATH>


    <H3> Control Model -- Cost Model -- Socioeconomic Model </H3>
        
        This is the model I anticipate the user interacting with the
        most, since it is used on a continuing basis during the 
        development of each and every control strategy.  In addition to
        managing the problem of specifying controls, the control model
        needs to provide information to support the decision-making
        activity of selecting <EM>which controls to apply</EM>.  The
        control model interface, therefore needs to supply the user
        with information
        <UL> 
            <LI>  What are the most important sources?
            <LI>  Where are the most important sources?
            <LI>  What controls are already present?
            <LI>  How expensive are particular sorts of controls 
                  to apply?
            <LI>  How much reduction does a particular control achieve
                  (both in absolute terms, and as a fraction of the 
                  inventory total)?
            <LI>  In what order are various types of controls applied?
                  and how do their results compare?
        </UL><P> 



<HR> <!----------------------------------------------------------------->

<A HREF = "INTRO.html"> 
<STRONG>Previous: </STRONG>  Introduction </A>
<P> 

<A HREF = "EPSDIFS.html"> 
<STRONG>Next: </STRONG>  Differences between SMOKE and UAM EPS </A>
<P> 

<A HREF = "index.html"> 
<STRONG>Top: </STRONG>  SMOKE Root Document  </A>
<P> 


</BODY>      <!--end body  -->
</HTML>      <!--end html  -->

