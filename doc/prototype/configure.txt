SMOKE Prototype configuration instructions

This document contains information on...

How to install a new inventory
How to change the number of inventory files
How to change the number of sources
How to set up for a new emissions scenario
How to use a study template
What to check before running studies

-------------------------------------------------------------------------
Before running a study using a new inventory, here are the things that
must be done.  You only have to do this once for each new inventory you
install.  UNIX commands are preceded by a percent sign.

1) Create assigns file:
   These steps must be done in a window in which you have never sourced an 
     Assigns file.

 % cd $SMKROOT/scripts
 % setenv ASSIGN_FILE $SMKROOT/assigns/ASSIGNS.<Your Scenario>.<Your Grid>
      (with the Scenario and Grid names you plan to use filled in)
 % source bld_assigns

   A list of environment variables will be printed out, keep this list.

 % cd $SMKROOT/assigns
   
   Now edit the Assigns file you just created, and fill in the environment
     variables that do not have definitions (using the list you saved
     previously).
     
2) Make sure include files are there:
   % cd $SMKROOT/inc
  
   Make sure that a directory named with your value of INVEN is at
   $SMKROOT/inc, and that the following files are in it:
      ARDIMS3.EXT       CHDIMS3.EXT       VGRD3.EXT
      BIODIMS3.EXT      MBDIMS3.EXT       SPDIMS3.EXT       
      CHDGEN3.EXT       PTDIMS3.EXT       TMDIMS3.EXT

   These files can be copied from the files in the $SMKROOT/inc/demo
   directory.

   Make sure one directory for each grid is also at $SMKROOT/inc, named
   with the name of the grid used to define the GRID environment variable. 
   Each of these directories should have a GRDIMS3.EXT file that has been
   configured for the grid of interest.  This file can be copied from
   the $SMKROOT/inc/nc36 directory, and modified as appropriate.

3) Put inventory in place:
   In the $SMKROOT/assigns directory, source the ASSIGNS file you 
   created in step (1)

   Make directories:
    % mkdir $INVDIR
    % mkdir $INVDIR/arpt
    % mkdir $INVDIR/mobile
    % mkdir $INVDIR/biog

    Put the inventory files you will be using in the subdirectories (arpt
    for area and point files).  Typically, you'll have all states' area
    and point files directly in the arpt subdirectory, and not in the
    subdirectories for each state.  

    The emissions file names can be whatever you like, although it helps
    to use the same prefix for point source files that go together (for
    example, use nc.emission.pt, nc.facility.pt, etc. for the North
    Carolina EMS-95 files). The following is a list of file names that are
    usually used for EMS-95 inputs.

       AREA: *.area.ar
       POINT: *.emission.pt *.facility.pt *.stack.pt *.process.pt *.device.pt
       HOURLY POINT: *.phrspec.pt
       DAILY POINT: *.pdayspec.pt
       NON-LINK: offnvmt.*
       LINK: onnvmt.*

NOTE: continue this step by following instructions in next section

--------------------------------------------------------------------------
Instructions for starting with new inventory OR changing the number of
inventory data files (does not apply if only the existing files have been
changed). 

1) Create or modify appropriate ANLST, PNLST, MNLST, MLKLST input files
   in the $INVDIR directory.  If you have not sourced the ASSIGNS file in
   your window, do so now before using the commands below.

   These files should be formatted as described in the on-line
   documentation.  They will contain the INVYEAR packet and the file names
   of the input ASCII EMS-95 or other files.

2) When you run a Study with a new inventory, you must change the INVEN
   Global environment variable.

NOTE: continue this step by following instructions in next section

--------------------------------------------------------------------------
Instructions for starting with new inventory OR changing the number of 
files OR changing the number of sources to the inventory

1a) You DON'T KNOW the number of sources in the inventory for each source
 
   First, compile a few programs using the current include file settings
   for the number of sources.  To do this, use the following commands:
   % cd $SMKROOT/assigns
   % source ASSIGNS.<Your scenario>.<Your grid>
   % cd $PT_SRC
   % make emspoint <NOTE: use "make rawpoint" for EPS2.0 inputs>
   % cd $AR_SRC
   % make emsarea <NOTE: use "make rawarea" for EPS2.0 inputs>
   % cd $MB_SRC
   % make rawmobil
  
   Next, go to the $SMK_BIN directory in a window in which you've sourced
   the ASSIGNS file.

   Then execute the following programs at the prompt:

      Area sources  : emsarea (EMS-95 inputs) OR rawarea (EPS2.0 inputs)
      Mobile sources: rawmobil
      Point sources : emspoint (EMS-95 inputs) OR rawpoint (EPS2.0 inputs)

    To this this, simply type the program name at the prompt and hit 
    enter.

    If the programs are not compiled for the correct number of sources,
    and nothing else goes wrong while importing the inventory data,
    these programs will tell you how many SMOKE-type sources are in
    your inventory.  Write these numbers down for each of the source
    categories.  If the program completes with a "Normal Completion"
    message, then your program is already compiled with the correct
    number of sources.

    Continue to instructions for (1b) and remainder of this section.      
   
1b) You DO KNOW the number of sources in the inventory for each source
    category of interest.
 
    Change the following files and parameters in the $INC directory:
      Area sources  : ARDIMS3.EXT - Change NASRC
      Mobile sources: MBDIMS3.EXT - Change NMSRC
      Point sources : PTDIMS3.EXT - Change PTSRC

2) Compile all the standard executables: 
   % cd $SCRIPTS
   % Makeall $SMKROOT/assigns/ASSIGNS.<Your scenario>.<Your grid>  

   This will take a while to run

   If you are getting messages about "Cannot write to file...", then this
     is a permissions problem.

   If you start getting core dumps, then log out, log in again, and retry.

3) Compile the executables for different grids.  For example.
   Repeat step 2 for other grids.

4) To: build QA programs not included in Makeall, or to build SMOKE
   programs individually, use the example below as a guide. You do not
   need to re-source the ASSIGNS file every time, but it is listed here as
   a reminder.
   >  cd $ASSIGNS
   >  source ASSIGNS.<ESCEN>.nc36
   >  cd $QA_SRC
   >  make aoicpop aoicsum areasum asctsum getrecs mvehsum \
           plantsum pntsum psccsum repnorm repplht reptpro
   
--------------------------------------------------------------------------
Instructions for starting with new emissions scenario

1) Install potentially-scenario-specific files in $STATIC dir:
   The following files must be placed in the $STATIC directory.  These
   can be linked from other scenario directories, or copied.

   $STATIC/mplist.<Your ESCEN>.txt
   $STATIC/mpref.<Your ESCEN>.txt
   $STATIC/SPCS.<Your ESCEN>.txt
   $STATIC/vmtmix.<Your ESCEN>.txt

2) When you run a SMOKE study with a new Emissions Scenario, you must
   change the ESCEN global environment variable. 

--------------------------------------------------------------------------
Instructions for creating a new study by copying the "demo" studies.

1) Use the New menu item of the Study menu.  Click on "Find Original..." 
   to copy from one of the demo Studies:

      Smoke Onetime Demo
      Smoke By Month Demo
      SMOKE Scenario Demo
      Smoke QA Demo

      Choose a name and abbreviation for your study.

2) When you first start the Study, don't forget to click on the "Public"
   box if you want other EDSS users to see your study.

3) You must change the Global Environment Variables for inventory (INVEN),
   emission scenario (ESCEN), met scenario (MSCEN), biogenics scenario
   (BSCEN), grid (GRID), Smoke root directory (SMKROOT), smoke data
   directory (SMKDAT).  See below for additional info.

--------------------------------------------------------------------------
Instructions for running studies - things to check

1) Set the Global environment variables

   These are the global environment variables you need to pay attention
   to:

   INVEN - Inventory name using naming convention (top of list)
   ESCEN - Emissions scenario name using naming convention (top of list)
   MSCEN - Met scenario - only for ASSIGNS file (bottom of list)

2) Local environment variables:

   BIOGENICS STUDY:
      BG_CLOUD_TYPE - nodes tmpbio_4km, tmpbio_12km, tmpbio_36km
          This should be set to 2 for your runs, but with old met
          files had to use 5 for the 4km and 4 for the other grids. If 2
          produces very low biogenic emissions, then it's because the
          RGRND (solar radiation at the ground), is all zeroed coming
          out of MCIP.

   MOBILE STUDY:
      EF_YEAR - node emisfac.  This should be set to the year of the
          emission factors that you want MOBILE5b to generate
      EF_MIN_TEMP - node emisfac.  
      EF_MAX_TEMP - node emisfac.
          Look out for error M111 or others in the log file that mention
          that the minimum or maximum temperatures are a problem.  If so,
          adjust the EF_MIN_TEMP lower and the EF_MAX_TEMP higher.  You
          must make sure that these values are consistent with the values
          compiled in the programs PREDIUR, EMISFAC, and TMPMOBIL (for 
          all grids).
