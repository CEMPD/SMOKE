
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML> 
<HEAD>
<TITLE> 
    Differences between SMOKE and EMS-95
</TITLE>
</HEAD>
   
<BODY BGCOLOR="FFFFFF">
<!--#include virtual="/INCLUDES/header.html" -->

<H1> Differences between SMOKE and EMS-95</H1>

<blockquote><b>
 Copyright &copy; 1999 MCNC--North Carolina Supercomputing Center <br>
 All rights reserved
</b></blockquote>


<H2> Contents </H2>

<UL>
    <LI>  <A HREF = "#note">  Note from author </A>
    <LI>  <A HREF = "#tech">  Technical Differences </A>
    <LI>  <A HREF = "#input">  Input Differences </A>
    <LI>  <A HREF = "#qa">  QA Differences </A>

</UL>

<HR> <!----------------------------------------------------------------->

<A NAME = "note">
The following is a list of differences between the SMOKE prototype and
EMS-95. Since I haven't worked with EMS-95 in a while, I could be missing
some differences, and EMS-95 might have been changed such that there are
more or fewer differences.  There are many differences in conceptual
design that I have not mentioned; instead, I've focus on the differences
that will affect emissions calculations, input preparation, and QA. 
<em>-MH</em><p>

<hr>
<A NAME = "tech">
<H2>Technical differences that affect emissions computations</H2>

<b>Using time zones for applying weekly/monthly profiles</b><p>

SMOKE has been updated to apply the day-of-week (weekly) and monthly
profiles based on the time zone of each source.  This is necessary to
prevent sources in several time zones from simultaneously changing days at
the same hour. EMS-95 does not use the time zone of a source to determine
when each day or month starts.  In comparing the outputs
from the two systems, emissions would only be affected for (N-1) hours per
day, where N is the number of time zones in the inventory. <p>

<b>Weekday versus average-day weekly profiles</b><p>

SMOKE can treat weekly profiles as having been developed on a weekday
basis or on and average-day basis.  This distinction affects the meaning
of the weekly profile numbers significantly.  For EMS-95 formatted
inventory inputs (a.k.a. foundation files), the weekday method is used,
and for EPS2.0 formatted inventory inputs, the average-day method is used. 
The input format of the temporal profiles is the EPS2.0 format in both
cases.  The difference in computations used can be found in the source
code file $PT_SRC/mktmat.F: it is the difference between the XFAC and WFAC
calculations.<p>

<b>Diurnal temporal profiles are renormalized</b><p>

The diurnal temporal profiles in SMOKE are renormalized in the reader
program. This means that the profile values for each hour are summed and
each value is divided by that sum, regardless of what the stated sum in
the input file is.  (Note that the input EPS2.0 input format requires the
sum to be provided in the file).<p>

<b> Weekday-Saturday-Sunday approach must be different in SMOKE</b><p>

When day-of-week adjustments do not occur on the same hour for all sources
because they are applied by time zone, this means that all sources do not
"change days" on the same day. This affects implementation of the
"weekday-Saturday-Sunday"  approach used in emission processing generally. 
For example, with four time zones in the inventory, a single 24-hour
"Saturday" file contains at best three hours from Friday, when the time
stamps in the file are in the same time zone as the minimum time zone i n
the inventory. The approach required becomes a
"Monday-weekday-Saturday-Sunday" approach when using SMOKE. <p>

<b>Gridded meteorology is converted to source-based meteorology</b><p> 

Because SMOKE relies on operations <em>by source</em>, the gridded
temperatures need to be converted to a source-based temperature for mobile
and point sources.  For mobile processing, this is done in SMOKE by an
"ungridding" matrix created by GRDMMAT, which contains factors for each
cell/source combination that compute these source-based temperatures.
These are the temperatures that SMOKE uses for using the MOBILE5 emission
factors.  For point processing, this is done in LAYPOINT for computing
plume rise. The effect on mobile source emissions is noticable, but small
- perhaps a couple of percent at most, and typically smaller. The effect
on plume rise is neglible.  The effect is smaller with finer grids than
with coarser grids. <p>

<b>Hourly and Min/Max Temperatures are not rounded</b> <p>

When SMOKE drives Mobile5, the emission factors are computed for every 2
degrees F and on 2-degree increments of combinations of min/max
temperature. (Note: it runs faster because only the actual min/max
temperatures in the meteorology inputs are used to call Mobile5). However,
when SMOKE applies the emission factor based on the source-based
temperature, the emission factors are linearly interpolated between the
temperatures.  EMS-95 applies the emission factors by the nearest
temperature or min/max temperatures available (to the best of our
knowledge).<p>

<b>Mobile5 input speeds are not rounded</b><p>
When Mobile5 is called by SMOKE, it received the speed information
directly from the MOBILE5 input file (in the MPREF file). So, there is no
rounding of speeds to the nearest 2 MPH as is done in EMS-95.<p>

<hr>
<A NAME = "input">
<H2>Differences that affect input preparation</H2>

<b>Speeds for Mobile5 inputs</b><p>

Unlike EMS-95, there is no speeds-per-source file.  When Mobile5 is run
from SMOKE, it gets the speeds from the Mobile5 input file (in MPREF). So,
the speeds that are in this file must be correct for the
state/county/episode.<p>

<b>Mobile input formats are different</b><p>

None of the mobile-source inputs are the same format as EMS-95 because we
wanted to be able to use list-directed reads.  With this method, the file
columns need only to be delimited by a comma or space, but the columns
in which each entry appear are not important.  This permits users to
output the proper format from a spreadsheet program using
comma-separated-variables format (although a DOS-to-UNIX conversion
of the text file is needed if this is not handled by ftp or the file
server).<p>

<b>Cross-references and profile formats</b><p>

Many of the input formats for the cross-references and profiles are the
same as the EPS2.0 formats.  In some cases, a format similar to EMS-95 is
permitted.  One confusing issue is with the spatial surrogates files.  THe
area sources program can read an EMS-95-like format, but mobile sources
cannot.  We have converters for the surrogates formats that are written in
SAS, but that require some SAS knowledge to reset for a given case.

<b>Default stack parameters</b><p>

Default stack parameters in SMOKE require a ASCII file.  This may be
handled differently in EMS-95.  The file permits different defaults based
on state and county.<p>

<b>Controls inputs are different and less extensive</b><p>

SMOKE controls are not as highly developed as those of EMS-95.  The
control programs (ctlamat and ctlpmat) have been updated and corrected
since the SMOKE prototype tar file was last put on the web site.  The
input format is the same as EPS2.0, but not all of the EPS2.0 control
packets are supported by SMOKE.<p>

<b>Only CO, NOx, and VOC/ROG are supported</b><p> 

The SMOKE prototype is hard coded to handle CO, NOx, and VOC or ROG.  A
different include file is needed for VOC than for ROG, and the programs
must be recompiled. The include file that comes with the prototype
distribution contains ROG.<p>


<hr>
<A NAME = "qa">
<h2>Differences that affect QA</h2>

<b>SMOKE does not have reports at each stage of the processing</b>

In EMS-95, reports are written at each stage of the processing to make
sure that everything is working properly. In SMOKE, the vector-matrix
approach makes this more difficult, because emissions are not actually
multiplied with the factors for speciation, gridding, etc. until the merge
stage.  The one exeption to this the temporal processing.  The ATMP, PTMP,
and MTMP SMOKE intermediate files contain the emissions with the temporal
factors already applied.<p>

In order to get information about the impact of each stage of the
processing, there are QA programs that must be run using several
configurations, to obtain the reports for each stage of the processing.
This programs and reports are the following:<p>

<ul>
<li><b>Gridded inventory emissions + report:</b><br>
    Run GRDPOINT/GRDAREA with PNTS/AREA file and PGMAT/AGMAT
<li><b>Gridded VMT + report:</b><br>
    Run GRDMOBIL with MOBL and MGMAT
<li><b>Speciated, gridded inventory emissions + report:</b><br>
    Run CSGPOINT/CSGAREA with PNTS/AREA file and PGMAT/AGMAT and
    PSMAT/ASMAT
<li><b>Gridded hourly emissions + report:</b><br>
    Run GRDPOINT/GRDAREA/GRDMOBIL with PTMP/ATMP/MTMP and
    PGMAT/AGMAT/MGMAT
<li><b>Speciated, gridded, hourly emissions + report:</b><br>
    Run CSGPOINT/CSGAREA/CSGMOBIL with PTMP/ATMP/MTMP and
    PGMAT/AGMAT/MGMAT and PSMAT/ASMAT/MSMAT
</ul>

In addition, all of the factors being used for a source or group of
sources can be obtained from the GETRECS program in the qa_src directory. 
This program reads the inventory, hourly data, and matrices and creates a
report with these data for each of the sources selected by the user when
running the program.  The version that is in the prototype release works
only for point sources, but we have another version that can be used the
area and mobile sources as well. 
<p>

<b>State and county totals</b><p>
The programs listed above will produce state totals only.  We have updated
versions of the point and area programs that will also produce county
totals, but these are not in the released version of the prototype.  The
biogenics processor REPBIO produces state and county totals.<p>


<HR> <!----------------------------------------------------------------->

<STRONG><A HREF = "EPSDIFS.html">
Previous:  Differences between SMOKE and UAM EPS2.0
</A></STRONG>
<P>

<STRONG><A HREF = "AREA.html">
Next:  Area sources
</A></STRONG>
<P>

<STRONG><A HREF = "index.html">
Up:  SMOKE home page
</A></STRONG>
<P>



<!--#include virtual="/INCLUDES/footer.html" -->
</BODY>      <!--end body  -->
</HTML>      <!--end html  -->


