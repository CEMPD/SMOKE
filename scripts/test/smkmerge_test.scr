#!/bin/csh -f

# This scripts tests Smkmerge for a variety of input file formats and
# source categories, and compares to the results achived previously.

# General settings
setenv RUN_SMKMERGE Y
setenv REPORT_DEFAULTS N

set debugmode = Y

# Dependent settings
if ( $debugmode == Y ) then
   set command = 'dbx $MG_SRC/smkmerge.debug'
else
   set command = '$SMK_BIN/smkmerge
endif

# Case descriptions
# Case 1: m3demo case (IDA input formats for area, mobile, and point sources)
# Case 2: Texas case (EPS input formats for area and point sources)
# Case 3: Utah case (EMS-95 input formats for ar,mb,& pt sources, w/day-spec pt)
# Case 4: Net 96
# Case 5: REMSAD on western US - point only

# Case controls
set case1_ar  = N
set case1_bg  = N
set case1_mb  = N
set case1_pt  = N
set case1_all = N

set case2_ar = N
set case2_pt = N

set case3_ar = N
set case3_mb = N
set case3_pt = N

set case5_pt = Y

# Case 1
########################################################################

setenv MRG_TEMPORAL_YN      Y          # Y merges with hourly emissions
setenv MRG_SPCMAT_YN        Y          # Y merges with speciation matrix
setenv MRG_GRDOUT_YN        Y          # Y outputs gridded file
setenv MRG_LAYERS_YN        N          # Y merges with layer fractions
setenv MRG_REPSTA_YN        Y          # Y outputs state totals
setenv MRG_REPCNY_YN        N          # Y outputs county totals
setenv SMK_ASCIIELEV_YN     N          # Y outputs ASCII elevated file
setenv MRG_GRDOUT_UNIT      tons/hr    # units for gridded output file
setenv MRG_TOTOUT_UNIT      tons/day   # units for state and/or county totals
setenv MRG_REPORT_TIME      230000     # hour in OUTZONE for reporting emissions
setenv MRG_MARKETPEN_YN     N          # apply reac. controls market penetration
setenv SPC_INPUT            mass       # [mass|mole] controls speciation merge
setenv SMK_ASCIIELEV_FMT    UAM        # [UAM] format of ASCII elevated file
setenv AREA_SURROGATE_NUM   60         # number for area surrogate
setenv SMK_O3SEASON_YN      N     # Y uses O3-season emissions instead of annual
setenv OUTZONE              0     # output time zone of emissions

if ( $case1_ar == Y ) then

    setenv MRG_SOURCE A
    source /env/proj/smoke/assigns/ASSIGNS.m3demo.cb-iv.ed36

    $command 

endif

if ( $case1_bg == Y ) then

    setenv SMK_SOURCE B
    setenv MRG_SOURCE B
    source /env/proj/smoke/assigns/ASSIGNS.m3demo.cb-iv.ed36

    $command 

endif

if ( $case1_mb == Y ) then

    setenv MRG_SOURCE M
    source /env/proj/smoke/assigns/ASSIGNS.m3demo.cb-iv.ed36

    $command 

endif

if ( $case1_pt == Y ) then

    setenv MRG_SOURCE P
    source /env/proj/smoke/assigns/ASSIGNS.m3demo.cb-iv.ed36

    $command 

endif

if ( $case1_all == Y ) then

    setenv MRG_LAYERS_YN        Y        # Y merges with layer fractions
    setenv MRG_REPSTA_YN        N        # Y outputs state totals
    setenv MRG_REPCNY_YN        N        # Y outputs county totals
    setenv SMK_EMLAYS           12       # number of emissions layers
    setenv MRG_GRDOUT_UNIT      moles/hr   # units for gridded output file
    setenv MRG_TOTOUT_UNIT      moles/s    # units for state and/or county totals
    setenv SPC_INPUT            mole     # [mass|mole] controls speciation merge

    setenv MRG_SOURCE ABMP
    source /env/proj/smoke/assigns/ASSIGNS.m3demo.cb-iv.ed36
    setenv ASMAT $ASMAT_L
    setenv BGTS  $BGTS_L
    setenv MSMAT $MSMAT_L
    setenv PSMAT $PSMAT_L

    $command 

endif


# Case 2
########################################################################

if ( $case2_ar == Y ) then

    setenv MRG_SOURCE A

    $command 

endif

if ( $case2_pt == Y ) then

    setenv MRG_SOURCE P
    setenv WKDAY_NORMALIZE      Y
    setenv IMPORT_AVEINV_YN     N 
    setenv HOUR_SPECIFIC_YN     Y
    setenv DAY_SPECIFIC_YN      Y
    setenv INVDIR /env/data/smoke/inventory/dfw96
    setenv INVOPD /env/data/smoke/inventory/dfw96ba
    setenv PTINV  $INVDIR/pnlst.v1.dfw96.txt
    setenv PTDAY  $INVDIR/ptday.dfw96.txt
    setenv PTHOUR $INVDIR/pthour.dfw96.txt
    setenv SIPOLS $INVDIR/sipols.txt
    setenv COSTCY /env/data/smoke/ge_dat/costcy.txt
    setenv PSCC   $INVOPD/PSCC.dfw96ba02.txt
    setenv PSRC   $INVOPD/PSRC.dfw96ba02.txt
    setenv PNTS   $INVOPD/pnts.dfw96ba02.ncf
    setenv PDAY   $INVOPD/pday.dfw96ba02.ncf        
    setenv PHOUR  $INVOPD/phour.dfw96ba02.ncf
    setenv PSTK   /env/data/smoke/ge_dat/stack_defaults_old.txt

    $command 

endif

# Case 3
########################################################################

setenv MRG_GRDOUT_YN        N          # Y outputs gridded file
setenv MRG_REPSTA_YN        N          # Y outputs state totals
setenv MRG_REPCNY_YN        Y          # Y outputs county totals
setenv MRG_GRDOUT_UNIT      moles/hr    # units for gridded output file
setenv MRG_TOTOUT_UNIT      "tons/day"   # units for state and/or county totals
setenv SMK_O3SEASON_YN      Y     # Y uses O3-season emissions instead of annual

if ( $case3_ar == Y ) then

    setenv MRG_SOURCE A
    source /env/proj/smoke/work/mrh/assigns/ASSIGNS.aero96.ut_aero
    setenv ASMAT $ASMAT_S

    $command 

endif

if ( $case3_mb == Y ) then

    setenv MRG_SOURCE M
    setenv SMK_USE_SIPOLS Y
    setenv SMK_USE_ACTVNAMS N
    source /env/proj/smoke/work/mrh/assigns/ASSIGNS.aero96.ut_aero
    setenv MSMAT $MSMAT_S

    $command 

endif

if ( $case3_pt == Y ) then

    setenv MRG_SOURCE P
    source /env/proj/smoke/work/mrh/assigns/ASSIGNS.aero96.ut_aero
    setenv PSMAT $PSMAT_L

    $command 

endif

# Case 4
########################################################################

# Case 5
########################################################################

setenv MRG_REPSTA_YN        N          # Y outputs state totals
setenv SMK_ASCIIELEV_YN     Y          # Y outputs ASCII elevated file
setenv MRG_GRDOUT_UNIT      "gm moles/hr"   # units for gridded output file
setenv MRG_TOTOUT_UNIT      moles/day   # units for state and/or county totals
setenv MRG_REPORT_TIME      230000     # hour in OUTZONE for reporting emissions
setenv MRG_MARKETPEN_YN     N          # apply reac. controls market penetration
setenv SPC_INPUT            mole       # [mass|mole] controls speciation merge
setenv SMK_ASCIIELEV_FMT    UAM        # [UAM] format of ASCII elevated file
setenv OUTZONE              0     # output time zone of emissions
setenv UAM_LAYERS           8          # total number of layers
setenv UAM4_LAYBELOW        4          # below the diffbreak
setenv UAM4_LAYABOVE        4          # above the diffbreak
setenv UAM4_HTSFC           0          # height of surface layer in meters
setenv UAM4_HTLOWR          150        # minimum height below diffbreak in m.
setenv UAM4_HTUPPR          5000       # minimum height between diffbreak and
setenv UAM_VERTICAL_METHOD  STACKHGT   # STACKHGT is default
setenv SMK_CUTOFF_HT        40.   
setenv UAM4_DIFFBREAK_UNIT  0         # default is 0
setenv UAM4_REGIONTOP_UNIT  0         # default is 0

if ( $case5_pt == Y ) then

    setenv MRG_SOURCE P
    setenv G_STDATE 1996258
    setenv G_STTIME 00
    setenv INDIR /env/scratch/long/mhouyoux/remsad
    setenv PNTS  $INDIR/pnts.net96.ncf
    setenv PSRC  $INDIR/PSRC.net96.txt
    setenv PSMAT $INDIR/psmat.mole.cbiv.remsad.ncf
    setenv PGMAT $INDIR/pgmat.us36.remsad.ncf
    setenv PELV  $INDIR/PELV.net96.txt
    setenv PTMP  $INDIR/ptmp.1996258.1.remsad.ncf
    setenv PGTS  $INDIR/pgts.out.ncf
    setenv PGTSELEV $INDIR/pgtselev.txt
    setenv STACK_GROUPS $INDIR/stack_groups.us36.net96.ncf
    setenv G_GRIDPATH $INDIR/G_GRIDPATH.us36

    $command 

endif

