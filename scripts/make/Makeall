#!/bin/csh -f

## This script makes all of the SMOKE programs

#
## Set controllers for turning on/off library building
#
setenv FS_MAKE_LIB      Y   # [ Y | N ]
setenv ETOOLS_MAKE_LIB  Y   # [ Y | N ]
setenv SMK_MAKE_LIB     Y   # [ Y | N ]
setenv SMK_MAKE_MOBLIB  6   # [ 6 | N ]

#
## Set the directory for the EDSS installation
if ( $?EDSS_SUBSYS ) then
   if ( $?SMKROOT ) then
   else
      setenv SMKROOT $EDSS_SUBSYS/smokev1
   endif
else

   echo "ERROR: Environment variable EDSS_SUBSYS needs to be set to"
   echo "       use this script"
   exit( 1 )

endif

#
## Set the directory for the sysflags and smk_mkdir scripts
 
set assigndir = $SMKROOT/assigns

#
## Source the sysflags script to set environment variables for compiling
#

if ( ! -e $assigndir/sysflags ) then
   echo "Cannot find sysflags file\!"
   echo " "
   echo "Get set up for EDSS or set SMKROOT to the"
   echo "   path of the Assigns file."
   exit( 1 )
else

   source $assigndir/sysflags

endif

## Activate script argument
set what = $argv

#
## Make FileSetAPI library
#
if ( $FS_MAKE_LIB == Y ) then
   echo "Building FileSetAPI library..."
   cd $EDSS_SUBSYS/filesetapi
   make clean
   make lib
endif

#
## Make EDSS tools library
#
if ( $ETOOLS_MAKE_LIB == Y ) then
   echo "Building EDSS Tools library..."
   cd $EDSS_SUBSYS/edss_tools/setup
   source Setup
   cd $ETLSRC
   make clean
   Makeit $argv
endif

#
## Set up for SMOKE compiling
#
cd $assigndir
source $assigndir/ASSIGNS.m3demo.cb-iv.ed36

#
## Make SMOKE library
#
if ( $?SMK_MAKE_LIB ) then

   if ( $SMK_MAKE_LIB == 'Y' ) then
      echo "Building SMOKE library..."
      cd $MD_SRC
      make clean
      cd $EL_SRC
      make clean
      Makeit $argv
   endif

endif

#
## Make Mobile5b library, if requested
#
if ( $?SMK_MAKE_MOBLIB ) then

   if ( $SMK_MAKE_MOBLIB == '5A' ) then
      echo 'NOTE: Mobile5a library build not supported in this version'
   endif 

   if ( $SMK_MAKE_MOBLIB == '5B' ) then
      echo 'NOTE: Mobile5a library build not supported in this version'
   endif 

   if ( $SMK_MAKE_MOBLIB == '6' ) then
      echo "Building Mobile6 library..."
      cd $M6_SRC
      make lib
   endif

endif

#
## Make main programs
#
echo "Building Smkinven..."
cd $IV_SRC     # Smkinven
make clean
Makeit $argv    

echo "Building Spcmat..."
cd $SP_SRC     # Spcmat
make clean
Makeit $argv    

echo "Building Grdmat..."
cd $GD_SRC     # Grdmat
make clean
Makeit $argv    

echo "Building Cntlmat..."
cd $CL_SRC     # Cntlmat
make clean
Makeit $argv

echo "Building Temporal..."
cd $TM_SRC     # Temporal
make clean
Makeit $argv    

echo "Building Rawbio and Tmpbio..."
cd $BG_SRC    # Rawbio and Tmpbio
make clean
Makeit $argv

echo "Building Mbsetup, Premobl, and Emisfac..."
cd $MB_SRC     # Mbsetup, Premobl, and Emisfac
make clean
Makeit $argv    

echo "Building Elevpoint and Laypoint..."
cd $PT_SRC     # Elevpoint and Laypoint
make clean
Makeit $argv

echo "Building Smkmerge and Mrggrid..."
cd $MG_SRC     # Smkmerge and Mrggrid
make clean
Makeit $argv

echo "Building Utilities..."
cd $UT_SRC     # Smk2emis and Uam2ncf
make clean
Makeit $argv

echo "Building Quality Assurance..."
cd $QA_SRC     # Smkreport
make clean
Makeit $argv


exit( 0 )

